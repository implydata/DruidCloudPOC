# How to use the Druid Data Driver

## Program description

The Druid Data Driver is a python script that simulates a workload that generates data for Druid ingestion.
You can use a JSON config file to describe the characteristics of the workload you want the Druid Data Driver to simulate.
The script uses this config file to generate JSON records.

Run the program as follows:

```python DruidDataDriver.py <config file name> <options>```

Options include:

```
-n <total number of records to generate>
-t <duration for generating records>
```

The options control how long the script runs.
If no options are present, the script will run indefinitely.
The _-t_ and _-n_ options are exclusive (use one or the other).
Time durations may be specified in terms of seconds, minutes or hours.
For example, specify 30 seconds as follows:

```
-t 30S
```

Specify 10 minutes as follows:

```
-t 10M
```

Or, specify 1 hour as follows:

```
-t 1H
```

## Config File

The config file contains JSON describing the characteristics of the workload you want to simulate. The config file has the following format:

```
{
  "target": {...},
  "rate": {...},
  "dimensions": [...]
}
```

The _target_ object describes the output destination.
The _rate_ object describes the desired record generation rate.
The _dimensions_ list indicates the dimension each record should contain.

### Distribution descriptor objects

Use _distribution descriptor objects_ to parameterize various characteristics of the config file (e.g., interarrival times, dimension values, etc.) according to the config file syntax described in this document.

There are four types of _distribution descriptor objects_: Constant, Uniform, Exponential and Normal. Here are the formats of each of these types:

#### Constant distributions

The constant distribution generates the same single value.

```
{
  "type": "constant",
  "value": <value>
}
```

Where _value_ is the value generated by this distribution.

#### Uniform distribution

Uniform distributions generates values uniformly between _min_ and _max_ (inclusive).

```
{
  "type": "uniform",
  "min": <value>,
  "max": <value>
}
```

Where:
- _min_ is the minimum value sampled
- _max_ is the maximum value sampled

#### Exponential distribution

Exponenital distributions generate values following an exponential distribution around the mean.

```
{
  "type": "exponential",
  "mean": <value>
}
```

Where _mean_ is the resutling average value of the distribution.

#### Normal distribution

Normal distributions generate values with a normal (i.e., bell-shaped) distribution.

```
{
  "type": "exponential",
  "mean": <value>,
  "stddev": <value>
}

```

Where:
- _mean_ is the average value
- _stddev_ is the stadard deviation of the distribution

Note that negative values generated by the normal distribution may be force to zero when necessary (e.g., interarrival times).

### "target": {}

There are three flavors of targets: _stdout_, _file_ and _kafka_.

_stdout_ targets print the JSON records to standard out and have the form:

```
"target": {
  "type": "stdout"
}
```

_file_ targets write records to the specified file and have the following format:

```
"target": {
  "type": "file",
  "path": "<filename goes here>"
}
```

_kafka_ targets write records to a Kafka topic and have this format:

```
"target": {
  "type": "kafka",
  "endpoint": "<ip address and port>",
  "topic": <topic name>
}
```


### "rate":{}

The rate object is a _distribution descriptor object_ that describes the interarrival times (in seconds) between records that the driver generates.

One can calculate the mean interarrival time by dividing a period of time by the number of records to generate during the time period. For example, 100 records per hour has an interarrival time of 36 seconds (1 hour * 60 minutes/hour * 60 seconds/minute / 100 records).

See the previous section on _Distribution descriptor objects_ for the syntax.

### "dimensions": []

The _dimensions_ list contains specifications for all dimensions (except the <i>__time</i> dimension, which is always the first dimenstion in the output record specified in UTC ISO 8601 format, and has the value of when the record is actually generated).

#### Cardinality

All dimension types may include a _Cardinality_.
Cardinality defines how many unique values the driver may generate.
Setting _cardinality_ to 0 provides no constraint to the number of unique values.
But, setting _cardinality_ > 0 causes the driver to create a list of values, and the length of the list is the value of _cardinality_.

When _cardinality_ is greater than 0, _cardinality_distribution_ informs how the driver selects items from the cardinality list.
We can think of the cardinality list as a list with zero-based indexing, and the _cardinality_distribution_ determines how the driver will select an index into the cardinality list.
After using the _cardinality_distribution_ to produce an index, the driver constrains the index so as to be a valid value (i.e., 0 >= index < length of cardinality list).

As an example, imagine the following String element definition:

```
{
  "type": "string",
  "name": "Str1",
  "length_distribution": {"type": "uniform", "min": 3, "max": 6},
  "cardinality": 5,
  "cardinality_distribution": {"type": "uniform", "min": 0, "max": 4},
  "chars": "abcdefg"
}
```

This defines a String element named Str1 with five unique values that are three to six characters in length.
The driver will select from these five unique values uniformly (by selecting indices in the range of [0,4]).
All values may only consist of strings containing the letters a-g.

#### Dimension list item types

Dimension list entries include:

##### { "type": "string" ...}

String dimension speficiation entries have the following format:

```
{
  "type": "string",
  "name": "<dimension name>",
  "length_distribution": <distribution descriptor object>,
  "cardinality": <int value>,
  "cardinality_distribution": "<distribution descriptor object>",
  "chars": "<list characters used to build strings>"
}
```

Where:
- <i>name</i> is the name of the dimension
- <i>length_distribution</i> describes the length of the string values - Some distribution configurations may result in zero-length strings
- <i>cardinality</i> indicates the number of unique values for this diemnsion (zero for unconstrained cardinality)
- <i>cardinality_distribution</i> informs the cardinality selection of the generated values (omit if cardinality is zero)
- <i>chars</i> (optional) is a list (e.g., "ABC123") of characters that may be used to generate strings - if not specified, all printable characters will be used

##### { "type": "int" ...}

Integer dimension specification entries have the following format:

```
{
  "type": "int",
  "name": "<dimension name>",
  "distribution": "<distribution descriptor object>",
  "cardinality": <int value>,
  "cardinality_distribution": "<distribution descriptor object>"
}
```

Where:
- <i>name</i> is the name of the dimension
- <i>distribution</i> describes the distribution of values the driver generates (rounded to the nearset int value)
- <i>cardinality</i> indicates the number of unique values for this diemnsion (zero for unconstrained cardinality)
- <i>cardinality_distribution</i> skews the cardinality selection of the generated values

##### { "type": "float" ...}

Float dimension specification entries have the following format:

```
{
  "type": "float",
  "name": "<dimension name>",
  "distribution": "<distribution descriptor object>",
  "cardinality": <int value>,
  "cardinality_distribution": "<distribution descriptor object>"
}
```

Where:
- <i>name</i> is the name of the dimension
- <i>distribution</i> describes the distribution of float values the driver generates
- <i>cardinality</i> indicates the number of unique values for this diemnsion (zero for unconstrained cardinality)
- <i>cardinality_distribution</i> skews the cardinality selection of the generated values

##### { "type": "timestamp" ...}

Timestamp dimension specification entries have the following format:

```
{
  "type": "timestamp",
  "name": "<dimension name>",
  "distribution": "<distribution descriptor object>",
  "cardinality": <int value>,
  "cardinality_distribution": "<distribution descriptor object>"
}
```

Where:
- <i>name</i> is the name of the dimension
- <i>distribution</i> describes the distribution of timestamp values the driver generates
- <i>cardinality</i> indicates the number of unique values for this diemnsion (zero for unconstrained cardinality)
- <i>cardinality_distribution</i> skews the cardinality selection of the generated timestamps (optional - omit for unconstrained cardinality)


Note that if _distribution_ type is Normal, express _stddev_ in seconds.
